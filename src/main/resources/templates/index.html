<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Перевозки грузов</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <style>
        body {
            background-color: #f9f9f9;
        }
        .button-block {
            margin-top: 20px; /* Увеличенный отступ сверху */
        }
    </style>
</head>
<body>
<div class="bg-image" style="height: 100vh; overflow: auto">
    <blockquote class="blockquote text-center"><h1>Перевозки грузов</h1></blockquote>
    <div class="row">
        <div class="col-md-8 offset-md-4">
            <form th:action="@{/}">
                <input type="text" name="keyword" id="keyword" size="70" th:value="${keyword}" placeholder="Поиск груза" required/>
                <input type="submit" class="btn btn-success btn-sm" value="Поиск"/>
                <input type="button" class="btn btn-warning btn-sm" value="Очистить" id="btnClear"
                       onclick="clearSearch()"/>
            </form>
        </div>
    </div>

    <!-- Кнопки "Добавить груз" и "Гистограмма" с увеличенным отступом -->
    <div class="button-block">
        <blockquote class="blockquote text-center">
            <a href="/new">
                <button type="button" class="btn btn-primary" data-toggle="button" aria-pressed="false" autocomplete="off">
                    Добавить груз
                </button>
            </a>
        </blockquote>
        <blockquote class="blockquote text-center">
            <a href="/histogram">
                <button type="button" class="btn btn-secondary">Гистограмма</button>
            </a>
        </blockquote>
    </div>

    <!-- Окно с количеством грузов по дням -->
    <div class="cargo-count-window" style="max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin-top: 20px;">
        <h5>Количество грузов по дням</h5>
        <ul style="list-style-type: none; padding-left: 0;">
            <li th:each="entry : ${cargosByDayList}">
                <span th:text="${T(java.time.format.DateTimeFormatter).ofPattern('dd.MM.yyyy').format(entry.key)}">Дата</span>:
                <span th:text="${entry.value}">Количество</span> грузов
            </li>
        </ul>
    </div>

    <!-- Количество грузов -->
    <p class="text-dark" id="cargoCount" style="margin-top: 20px;">
        Количество грузов в таблице: <span th:text="${#lists.size(listCargo)}">11</span>
    </p>

    <table id="cargoTable" class="table table-striped table-hover">
        <thead>
        <tr>
            <th scope="col" class="sortable" data-field="id">ID груза</th>
            <th scope="col" class="sortable" data-field="name">Название груза</th>
            <th scope="col" class="sortable" data-field="contents">Содержимое груза</th>
            <th scope="col" class="sortable" data-field="departurecity">Город отправления</th>
            <th scope="col" class="sortable" data-field="departuredate">Дата отправления</th>
            <th scope="col" class="sortable" data-field="arrivalcity">Город прибытия</th>
            <th scope="col" class="sortable" data-field="arrivaldate">Дата прибытия</th>
            <th scope="col">Действия</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="cargo : ${listCargo}">
            <th scope="row" class="text-dark" th:text="${cargo.id}">ID груза отсутствует</th>
            <td class="text-dark" th:text="${cargo.cargoname}">Название груза отсутствует</td>
            <td class="text-dark" th:text="${cargo.cargocontents}">Содержимое груза отсутствует</td>
            <td class="text-dark" th:text="${cargo.departurecity}">Город отправления отсутствует</td>
            <td class="text-dark" th:text="${cargo.departuredate}">Дата отправления отсутствует</td>
            <td class="text-dark" th:text="${cargo.arrivalcity}">Город прибытия отсутствует</td>
            <td class="text-dark" th:text="${cargo.arrivaldate}">Дата прибытия отсутствует</td>
            <td>
                <a th:href="@{'/edit/'+${cargo.id}}"><button type="button" class="btn btn-info">Редактировать</button></a>
                <a th:href="@{'/delete/'+${cargo.id}}"><button type="button" class="btn btn-danger">Удалить</button></a>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script type="text/javascript">
    function clearSearch() {
        window.location = "[[@{/}]]";
    }

    // Сортировка таблицы
    document.addEventListener('DOMContentLoaded', function () {
        const table = document.getElementById('cargoTable');
        const headers = table.querySelectorAll('th.sortable');
        const tbody = table.querySelector('tbody');

        headers.forEach(header => {
            header.addEventListener('click', () => {
                const field = header.dataset.field;
                const rows = Array.from(tbody.rows);

                const isAscending = header.classList.contains('ascending');
                header.classList.toggle('ascending', !isAscending);
                header.classList.toggle('descending', isAscending);

                rows.sort((a, b) => {
                    const aText = a.querySelector(`td:nth-child(${Array.from(headers).indexOf(header) + 1})`).textContent;
                    const bText = b.querySelector(`td:nth-child(${Array.from(headers).indexOf(header) + 1})`).textContent;

                    if (isNaN(aText) && isNaN(bText)) {
                        return isAscending ? aText.localeCompare(bText) : bText.localeCompare(aText);
                    }
                    return isAscending ? aText - bText : bText - aText;
                });

                rows.forEach(row => tbody.appendChild(row)); // Добавляем отсортированные строки обратно в tbody
            });
        });

        // Подсчёт количества строк таблицы
        function getRowsColumn() {
            let table = document.getElementById('cargoTable');
            let tBody = table.querySelector('tbody');
            const count = tBody.querySelectorAll('tr').length;
            document.getElementById('cargoCount').innerHTML = 'Количество грузов в таблице: ' + count;
        }

        // Вызываем функцию после полной загрузки страницы
        getRowsColumn();
    });
</script>
</body>
</html>
